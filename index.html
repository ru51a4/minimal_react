<body>

<div class="main">
    <counter></counter>
</div>
</body>

<script>
    var Render;


    class component {

        name = '';

        constructor(_name) {
            this.name = name;
        }

    }

    class component_counter extends component{
        state = {
            counter: 0,
            counter2: 0
        };

        body() {
            return `
            <div>counter - ${this.state.counter} counter - ${this.state.counter2}
            <div>
            <div>
            ssasdasdasdasdssasdasdasdasdssasdasdasdasdssasddasdasdssasdasdasdasdssasdasdasdasdssas
            dasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasd
            asdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdasdasdasdssasdasdasdasdssasda
            sdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasd
            asdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasddasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasds
            sasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasd
            asdasddasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasds
            sasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasddasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasds
            sasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasddasdasdssasdasdasdasdssasdasdasdasdssasdasd
            asdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasddasdasdssasdas
            dasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssa
            sdasdasdasddasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasd
            asdssasdasdasdasdssasdasdasdasddasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasd
            asdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasddasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdas
            dasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasdssasdasdasdasd
            </div>
            </div>
            <btn></btn>
            <button onclick="runEvent(this.name, 'plus')">btn2</button>
            <text></text>
            </div>
        `
        };

        plus() {
            this.state.counter++;
            Render.renderDom();
        }
    }

    class component_btn extends component{

        body() {
            return `
                <button onclick="runParrentEvent(this.name, 'plus')">plus</button>
                <text></text>
                `
        };

        plus() {
            components.counter.plus();
        }
    }

    class component_text extends component{
        body() {
           return `<text2></text2>`
        };
    }

    class component_text2 extends component{
        body() {
            return `<div>texdt</div>`
        };
    }


    function runEvent(name, nameEvent) {

    }

    function runParrentEvent(name, nameEvent) {

    }

    var components = {};
    var currentComponents;
    class render {
        currentDom;

        constructor() {
            components = [
                    {
                        name: 'counter',
                        component: component_counter
                    },
                    {
                        name: 'btn',
                        component: component_btn
                    },
                    {
                        name: 'text',
                        component: component_text
                    },
                    {
                        name: 'text2',
                        component: component_text2
                    }
                ];
            this.currentDom = document.querySelector('.main').innerHTML.trim().split("\n");
        }

        renderDom() {
            var currentDom = '';
            this.currentDom.forEach((tag) => {
                //deep
                var hierarchyStack = [];
                function deep(tag) {
                    if(this.utils.isComponent(tag)) {
                        deep(tag);
                        hierarchyStack.pop();
                    } else {
                      const currentName = `${tag}-${currentComponents.length}`;
                      hierarchyStack.push(currentName);
                      let component = new components.find((item) => item.name === tag).component();
                      currentDom += `${component.body()} \n`;
                      currentComponents.push({
                          name: currentName,
                          component: component,
                          hierarchy: hierarchyStack.join('.')
                      });
                    }
                }
                deep.bind(this, tag)();
                //
            });
        }

        utils = {
          isComponent(tag){
              return components.map(item => item.name).includes(tag);
          }
        };
    }

    Render = new render();

    function main() {
        Render.renderDom();
    }

    main();

</script>
